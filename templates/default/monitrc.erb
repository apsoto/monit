set daemon <%= @node[:monit][:poll_period] %>
  with start delay <%= @node[:monit][:poll_start_delay] %>

set logfile syslog facility log_daemon

set mailserver localhost

set eventqueue
    basedir /var/monit  # set the base directory where events will be stored
#    slots 1000          # optionaly limit the queue size

set mail-format { 
  from: <%= @node[:monit][:mail_format][:from] %>
  subject: <%= @node[:monit][:mail_format][:subject] %>
  message: <%= @node[:monit][:mail_format][:message] %>
}

<% if @node[:monit][:notify][:enable] %>
set alert <%= @node[:monit][:notify][:email] %> NOT ON { action, instance, pid, ppid }
<% end %>

<% if @node[:monit][:httpd][:enable] %>
set httpd port <%= @node[:monit][:httpd][:port] and
    <% unless @node[:monit][:httpd][:address].nil? %>
    use address <%= @node[:monit][:httpd][:address] %>
    <% end %>
    <% unless @node[:monit][:httpd][:allow].nil> %>
        <% @node[:monit][:httpd][:allow].each do |allow| %>
        allow <%= allow %>
        <% end %>
    <% end %>
<% end %>

include /etc/monit/conf.d/*.conf
